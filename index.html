<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>20 Week Fitness Journey</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        nav {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        nav a {
            margin-right: 20px;
            text-decoration: none;
            color: #007bff;
            font-weight: 500;
        }
        nav a:hover {
            text-decoration: underline;
        }
        nav a.active {
            color: #333;
            font-weight: 600;
        }
        .content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 30px;
        }
        h3 {
            color: #666;
        }
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .accountability-message {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            font-weight: 500;
        }
        .accountability-message.critical {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        .accountability-message.good {
            background: #d4edda;
            border-left-color: #28a745;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin: 10px 0;
        }
        .day-cell {
            text-align: center;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        .day-cell.hit {
            background: #d4edda;
            color: #28a745;
        }
        .day-cell.miss {
            background: #f8d7da;
            color: #dc3545;
        }
        .day-cell.future {
            background: #f0f0f0;
            color: #999;
        }
        .week-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .summary-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .summary-card.failed {
            border-left-color: #dc3545;
        }
        .summary-card.passed {
            border-left-color: #28a745;
        }
    </style>
</head>
<body>
    <nav>
        <a href="#this-week" class="active">This Week</a>
        <a href="#overall">Overall Progress</a>
    </nav>

    <div class="content" id="content">
        <p>Loading...</p>
    </div>

    <script>
        // Load data from JSON
        async function loadWeekData() {
            try {
                const response = await fetch('data.json');
                return await response.json();
            } catch (error) {
                console.log('No data.json found, using sample data');
                // Return sample data structure for now
                return {
                    currentWeek: 1,
                    weekStart: "2025-08-18",
                    days: [
                        { date: "2025-08-18", day: "Mon", calories: 1875, steps: 5112, protein: 195, fiber: 32, run: 0, lift: 1, bedOnTime: null, wakeOnTime: null },
                        { date: "2025-08-19", day: "Tue", calories: 1850, steps: 9100, protein: 165, fiber: 30, run: 15, lift: 0, bedOnTime: null, wakeOnTime: null },
                        { date: "2025-08-20", day: "Wed", calories: 1850, steps: 5234, protein: 165, fiber: 15, run: 15, lift: 0, bedOnTime: null, wakeOnTime: null },
                        { date: "2025-08-21", day: "Thu", calories: null, steps: 5234, protein: 190, fiber: 30, run: 0, lift: 1, bedOnTime: null, wakeOnTime: null },
                        { date: "2025-08-22", day: "Fri", calories: 1850, steps: 9100, protein: 165, fiber: 30, run: 0, lift: 1, bedOnTime: null, wakeOnTime: null },
                        { date: "2025-08-23", day: "Sat", calories: 1920, steps: 6000, protein: 185, fiber: 32, run: 0, lift: 0, bedOnTime: null, wakeOnTime: null, rest: true },
                        { date: "2025-08-24", day: "Sun", calories: null, steps: null, protein: null, fiber: null, run: 0, lift: 0, bedOnTime: null, wakeOnTime: null }
                    ],
                    targets: {
                        runMinutes: 15,
                        liftVolume: 1.0
                    }
                };
            }
        }

        function renderThisWeek(data) {
            const content = document.getElementById('content');
            
            // Calculate averages and totals
            const completedDays = data.days.filter(d => d.calories !== null);
            const avgCalories = completedDays.reduce((sum, d) => sum + (d.calories || 0), 0) / completedDays.length;
            const avgSteps = completedDays.reduce((sum, d) => sum + (d.steps || 0), 0) / completedDays.length;
            const totalRuns = data.days.filter(d => d.run > 0).length;
            const totalLifts = data.days.filter(d => d.lift > 0).length;
            const proteinDays = data.days.filter(d => d.protein >= 190).length;
            const fiberDays = data.days.filter(d => d.fiber >= 30).length;
            
            let html = `<h1>Week ${data.currentWeek} of 20</h1>`;
            
            // Accountability messages
            if (avgCalories > 1950) {
                html += `<div class="accountability-message critical">Averaging ${Math.round(avgCalories)} calories. You're over by ${Math.round(avgCalories - 1900)}. This won't work. It's only 20 weeks.</div>`;
            } else if (avgCalories > 1900) {
                html += `<div class="accountability-message">Averaging ${Math.round(avgCalories)} calories. Tighten up - you're ${Math.round(avgCalories - 1900)} over target.</div>`;
            }
            
            if (totalRuns < 3 && completedDays.length >= 5) {
                html += `<div class="accountability-message critical">Only ${totalRuns} runs done. You need 3 per week. No excuses - you can run when tired.</div>`;
            } else if (totalRuns < 3) {
                html += `<div class="accountability-message">You need ${3 - totalRuns} more run${3 - totalRuns > 1 ? 's' : ''} this week. Get it done.</div>`;
            }
            
            if (totalLifts < 3 && completedDays.length >= 5) {
                html += `<div class="accountability-message critical">Only ${totalLifts} lifts done. Need 3 per week. Remember: consistency earns rest days.</div>`;
            }
            
            // Add reality check for Sunday
            if (completedDays.length === 6 && totalRuns < 3) {
                html += `<div class="accountability-message critical">It's Sunday. You MUST run today or you fail Week ${data.currentWeek}. 15 minutes. That's it.</div>`;
            }
            
            // Charts container
            html += '<div class="chart-grid">';
            html += '<div class="chart-container"><canvas id="caloriesChart"></canvas></div>';
            html += '<div class="chart-container"><canvas id="stepsChart"></canvas></div>';
            html += '</div>';
            
            // Daily tracking grids
            html += '<h2>Daily Goals</h2>';
            
            // Protein grid
            html += '<h3>Protein (190g target)</h3>';
            html += '<div class="metric-grid">';
            data.days.forEach(d => {
                if (d.protein === null) {
                    html += `<div class="day-cell future">${d.day}<br>-</div>`;
                } else if (d.protein >= 190) {
                    html += `<div class="day-cell hit">${d.day}<br>✓ ${d.protein}g</div>`;
                } else {
                    html += `<div class="day-cell miss">${d.day}<br>✗ ${d.protein}g</div>`;
                }
            });
            html += '</div>';
            
            // Fiber grid
            html += '<h3>Fiber (30g target)</h3>';
            html += '<div class="metric-grid">';
            data.days.forEach(d => {
                if (d.fiber === null) {
                    html += `<div class="day-cell future">${d.day}<br>-</div>`;
                } else if (d.fiber >= 30) {
                    html += `<div class="day-cell hit">${d.day}<br>✓ ${d.fiber}g</div>`;
                } else {
                    html += `<div class="day-cell miss">${d.day}<br>✗ ${d.fiber}g</div>`;
                }
            });
            html += '</div>';
            
            // Week summary
            html += '<h2>Week Summary</h2>';
            html += '<div class="week-summary">';
            html += `<div class="summary-card ${totalRuns >= 3 ? 'passed' : 'failed'}">
                <strong>Runs: ${totalRuns}/3</strong><br>
                ${totalRuns < 3 ? `Need ${3-totalRuns} more` : 'Complete ✓'}
            </div>`;
            html += `<div class="summary-card ${totalLifts >= 3 ? 'passed' : 'failed'}">
                <strong>Lifts: ${totalLifts}/3</strong><br>
                ${totalLifts < 3 ? `Need ${3-totalLifts} more` : 'Complete ✓'}
            </div>`;
            html += `<div class="summary-card ${avgCalories <= 1900 ? 'passed' : 'failed'}">
                <strong>Avg Calories: ${Math.round(avgCalories)}</strong><br>
                Target: ≤1900
            </div>`;
            html += `<div class="summary-card ${avgSteps >= 5000 ? 'passed' : 'failed'}">
                <strong>Avg Steps: ${Math.round(avgSteps)}</strong><br>
                Target: ≥5000
            </div>`;
            html += '</div>';
            
            content.innerHTML = html;
            
            // Render charts
            setTimeout(() => {
                renderCaloriesChart(data);
                renderStepsChart(data);
            }, 100);
        }

        function renderCaloriesChart(data) {
            const ctx = document.getElementById('caloriesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.days.map(d => d.day),
                    datasets: [{
                        label: 'Calories',
                        data: data.days.map(d => d.calories),
                        backgroundColor: data.days.map(d => {
                            if (d.calories === null) return '#f0f0f0';
                            if (d.calories <= 1850) return '#28a745';
                            if (d.calories <= 1950) return '#ffc107';
                            return '#dc3545';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Daily Calories'
                        },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 1900,
                                    yMax: 1900,
                                    borderColor: 'rgb(255, 99, 132)',
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 1500,
                            max: 2200
                        }
                    }
                }
            });
        }

        function renderStepsChart(data) {
            const ctx = document.getElementById('stepsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.days.map(d => d.day),
                    datasets: [{
                        label: 'Steps',
                        data: data.days.map(d => d.steps),
                        backgroundColor: data.days.map(d => {
                            if (d.steps === null) return '#f0f0f0';
                            if (d.steps >= 5500) return '#28a745';
                            if (d.steps >= 4500) return '#ffc107';
                            return '#dc3545';
                        })
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Daily Steps'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10000
                        }
                    }
                }
            });
        }

        function renderOverallProgress() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <h1>20-Week Journey</h1>
                <div class="accountability-message">
                    Week 1 of 20. 19 weeks to go. Stay consistent and you earn rest days. Naps are allowed. You can train when tired.
                </div>
                <p>Overall progress tracking coming soon...</p>
            `;
        }

        // Handle navigation
        async function navigate() {
            const hash = window.location.hash || '#this-week';
            const links = document.querySelectorAll('nav a');
            links.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === hash) {
                    link.classList.add('active');
                }
            });
            
            if (hash === '#overall') {
                renderOverallProgress();
            } else {
                const data = await loadWeekData();
                renderThisWeek(data);
            }
        }

        window.addEventListener('hashchange', navigate);
        window.addEventListener('load', navigate);
    </script>
</body>
</html>